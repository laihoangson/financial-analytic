[
  {
    "objectID": "ml.html#part-1.-technical-analysis",
    "href": "ml.html#part-1.-technical-analysis",
    "title": "Stock Price Forecast",
    "section": "Part 1. Technical Analysis",
    "text": "Part 1. Technical Analysis\nThis section provides a comprehensive technical analysis of stock prices using multiple indicators. For each stock, I calculate key metrics:\n\nTrend Indicators:\n\n\nMA50/MA200: 50-day and 200-day Simple Moving Averages compare current price to medium/long-term trends (Price &gt; MA = bullish +1, Price &lt; MA = bearish -1)\nEMA20: 20-day Exponential Moving Average gives more weight to recent prices for short-term trend direction\n\n\nMomentum Indicators:\n\n\nRSI (14-day): Measures overbought (&gt;70 = -1) vs. oversold (&lt;30 = +1) conditions, with 30-70 being neutral\nMACD: Signal line crossover indicator (MACD &gt; 0 = +1 bullish momentum, MACD &lt; 0 = -1 bearish momentum)\n\n\nVolatility & Volume Indicators:\n\n\nBollinger Bands: Price above upper band = overbought (-1), below lower band = oversold (+1), within bands = neutral (0)\nMFI (Money Flow Index): Volume-weighted RSI (&gt;80 = -1 overbought, &lt;20 = +1 oversold, 20-80 = neutral)\n\nEach indicator is scored (+1 for bullish, -1 for bearish, 0 for neutral), with a final aggregate signal determining the overall market outlook (Positive, Negative, or Neutral).\n\n\nCode\n# Load necessary libraries\nlibrary(tidyverse)\nlibrary(dplyr)\nlibrary(tidyquant)\nlibrary(TTR)\nlibrary(xgboost)\nlibrary(plotly)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(readr)\n\n# 1. Load Data\n# Assuming the same directory structure\ndf &lt;- read_csv(\"data/cleaned/stock_prices.csv\")\ndf$date &lt;- as.Date(df$date)\ndf &lt;- df %&gt;% arrange(ticker, date)\n\n\n\n\nCode\n# Define function to calculate indicators\ncalculate_indicators &lt;- function(data) {\n  # Create the HLC matrix required by TTR functions\n  hlc &lt;- data %&gt;% select(high, low, close)\n  \n  data %&gt;%\n    mutate(\n      SMA_50  = SMA(close, n = 50),\n      SMA_200 = SMA(close, n = 200),\n      EMA_20  = EMA(close, n = 20),\n      RSI_14  = RSI(close, n = 14),\n      # FIX: Pass HLC as one argument and volume as the second\n      MFI_14  = MFI(hlc, volume = data$volume, n = 14)\n    ) %&gt;%\n    # MACD returns multiple columns\n    bind_cols(as_tibble(MACD(data$close, 12, 26, 9, maType=\"EMA\"))) %&gt;%\n    # Bollinger Bands\n    bind_cols(as_tibble(BBands(data$close, n = 20, sd = 2)))\n}\n\n# Apply calculations to all tickers\ndf_ta &lt;- df %&gt;%\n  group_by(ticker) %&gt;%\n  filter(n() &gt; 200) %&gt;%\n  group_modify(~ calculate_indicators(.x)) %&gt;%\n  ungroup()\n\n# Scoring Logic\ndf_ta &lt;- df_ta %&gt;%\n  mutate(\n    MA50_Score  = case_when(close &gt; SMA_50 ~ 1, close &lt; SMA_50 ~ -1, TRUE ~ 0),\n    MA200_Score = case_when(close &gt; SMA_200 ~ 1, close &lt; SMA_200 ~ -1, TRUE ~ 0),\n    EMA_Score   = case_when(close &gt; EMA_20 ~ 1, close &lt; EMA_20 ~ -1, TRUE ~ 0),\n    MACD_Score  = case_when(macd &gt; signal ~ 1, macd &lt; signal ~ -1, TRUE ~ 0),\n    RSI_Score   = case_when(RSI_14 &lt; 30 ~ 1, RSI_14 &gt; 70 ~ -1, TRUE ~ 0),\n    BB_Score    = case_when(close &lt; dn ~ 1, close &gt; up ~ -1, TRUE ~ 0),\n    MFI_Score   = case_when(MFI_14 &lt; 20 ~ 1, MFI_14 &gt; 80 ~ -1, TRUE ~ 0)\n  ) %&gt;%\n  mutate(\n    Total_Score = MA50_Score + MA200_Score + EMA_Score + MACD_Score + RSI_Score + BB_Score + MFI_Score,\n    Signal = case_when(Total_Score &gt; 0 ~ \"Positive\", Total_Score &lt; 0 ~ \"Negative\", TRUE ~ \"Neutral\")\n  )\n\n# Generate Summary Table\nsummary_df &lt;- df_ta %&gt;%\n  group_by(ticker) %&gt;%\n  filter(date == max(date)) %&gt;%\n  select(ticker, close, volume, SMA_50, SMA_200, EMA_20, macd, RSI_14, up, dn, MFI_14, \n         contains(\"Score\"), Signal)\n\n# Display styled table using gt\nsummary_df %&gt;%\n  gt() %&gt;%\n  tab_header(title = \"Technical Analysis Summary - Latest Signals\") %&gt;%\n  fmt_number(columns = c(close, SMA_50, SMA_200, EMA_20, up, dn), decimals = 2) %&gt;%\n  fmt_number(columns = volume, suffixing = TRUE) %&gt;%\n  gt_color_rows(Total_Score, palette = c(\"red\", \"yellow\", \"green\")) %&gt;%\n  tab_style(\n    style = cell_fill(color = \"#d4edda\"),\n    locations = cells_body(columns = Signal, rows = Signal == \"Positive\")\n  ) %&gt;%\n  tab_style(\n    style = cell_fill(color = \"#f8d7da\"),\n    locations = cells_body(columns = Signal, rows = Signal == \"Negative\")\n  )\n\n\n\n\n\n\n\n\nTechnical Analysis Summary - Latest Signals\n\n\nclose\nvolume\nSMA_50\nSMA_200\nEMA_20\nmacd\nRSI_14\nup\ndn\nMFI_14\nMA50_Score\nMA200_Score\nEMA_Score\nMACD_Score\nRSI_Score\nBB_Score\nMFI_Score\nTotal_Score\nSignal\n\n\n\n\nAAPL\n\n\n248.68\n20.37M\n269.78\n234.74\n259.27\n-2.36946399\n23.54549\n279.58\n243.59\n25.31303\n-1\n1\n-1\n-1\n1\n0\n0\n-1\nNegative\n\n\nADBE\n\n\n302.73\n1.71M\n331.50\n357.65\n318.17\n-3.79778065\n34.05754\n369.17\n281.19\n32.94964\n-1\n-1\n-1\n-1\n0\n0\n0\n-4\nNegative\n\n\nAMZN\n\n\n239.68\n17.27M\n232.37\n220.30\n236.04\n0.59766662\n55.47537\n248.51\n225.03\n61.55384\n1\n1\n1\n-1\n0\n0\n0\n2\nPositive\n\n\nBAC\n\n\n51.58\n14.33M\n53.90\n48.30\n53.79\n-1.23120016\n34.56166\n58.15\n51.02\n45.30107\n-1\n1\n-1\n-1\n0\n0\n0\n-2\nNegative\n\n\nDIS\n\n\n111.56\n4.05M\n109.76\n110.60\n112.44\n0.39737151\n48.28802\n115.90\n110.75\n59.20544\n1\n1\n-1\n-1\n0\n0\n0\n0\nNeutral\n\n\nGOOGL\n\n\n328.39\n12.24M\n312.72\n229.67\n323.91\n1.80127254\n58.32054\n339.59\n306.99\n58.85994\n1\n1\n1\n-1\n0\n0\n0\n2\nPositive\n\n\nHD\n\n\n383.07\n996.84K\n356.24\n370.44\n368.76\n2.17222348\n65.62475\n395.07\n332.06\n75.39303\n1\n1\n1\n1\n0\n0\n0\n4\nPositive\n\n\nJNJ\n\n\n218.29\n2.19M\n206.78\n176.21\n212.80\n1.79453697\n67.65978\n222.64\n199.76\n60.93761\n1\n1\n1\n1\n0\n0\n0\n4\nPositive\n\n\nJPM\n\n\n297.76\n4.51M\n312.95\n288.98\n313.03\n-1.20877563\n34.77893\n340.64\n296.11\n45.10625\n-1\n1\n-1\n-1\n0\n0\n0\n-2\nNegative\n\n\nKO\n\n\n72.26\n5.75M\n70.56\n69.11\n70.70\n0.70710718\n62.89778\n72.89\n67.56\n62.38649\n1\n1\n1\n1\n0\n0\n0\n4\nPositive\n\n\nMA\n\n\n525.59\n1.74M\n553.92\n561.10\n550.38\n-1.56460317\n30.93978\n598.33\n519.88\n35.03904\n-1\n-1\n-1\n-1\n0\n0\n0\n-4\nNegative\n\n\nMETA\n\n\n661.78\n11.57M\n639.49\n676.81\n640.07\n-0.82320725\n57.21962\n683.17\n605.76\n56.27555\n1\n-1\n1\n1\n0\n0\n0\n2\nPositive\n\n\nMSFT\n\n\n469.30\n19.93M\n480.94\n482.82\n468.51\n-1.67824555\n48.27677\n498.43\n445.76\n42.65325\n-1\n-1\n1\n-1\n0\n0\n0\n-2\nNegative\n\n\nNFLX\n\n\n86.00\n34.57M\n97.70\n113.01\n89.75\n-3.64960133\n31.64944\n96.02\n84.00\n20.03264\n-1\n-1\n-1\n-1\n0\n0\n0\n-4\nNegative\n\n\nNVDA\n\n\n187.94\n80.23M\n183.83\n165.69\n184.93\n0.08988118\n54.29832\n191.68\n180.92\n46.66409\n1\n1\n1\n-1\n0\n0\n0\n2\nPositive\n\n\nPG\n\n\n150.58\n6.52M\n144.97\n153.20\n145.17\n0.73180086\n64.85683\n150.08\n138.06\n66.20983\n1\n-1\n1\n1\n0\n-1\n0\n1\nPositive\n\n\nPYPL\n\n\n56.91\n4.05M\n60.13\n67.19\n57.83\n-2.06688642\n42.09407\n60.67\n55.21\n35.16651\n-1\n-1\n-1\n1\n0\n0\n0\n-2\nNegative\n\n\nTSLA\n\n\n448.26\n34.98M\n442.38\n372.75\n444.51\n-0.77553181\n51.28174\n475.57\n416.33\n55.61414\n1\n1\n1\n-1\n0\n0\n0\n2\nPositive\n\n\nUNH\n\n\n355.18\n3.11M\n331.31\n332.55\n340.37\n1.29486565\n63.18486\n355.43\n323.15\n58.84521\n1\n1\n1\n1\n0\n0\n0\n4\nPositive\n\n\nV\n\n\n327.00\n2.25M\n338.03\n344.07\n336.65\n-1.43186372\n35.02471\n367.72\n316.84\n40.38805\n-1\n-1\n-1\n-1\n0\n0\n0\n-4\nNegative\n\n\nWMT\n\n\n118.40\n8.19M\n112.18\n102.04\n116.44\n1.71530489\n60.19195\n122.17\n108.92\n27.87472\n1\n1\n1\n1\n0\n0\n0\n4\nPositive"
  },
  {
    "objectID": "ml.html#part-2.-machine-learning",
    "href": "ml.html#part-2.-machine-learning",
    "title": "Stock Price Forecast",
    "section": "Part 2. Machine Learning",
    "text": "Part 2. Machine Learning\n1. Overview\nBuilding upon the technical analysis in Part 1, this section utilizes Machine Learning (XGBoost) to predict stock prices. Unlike traditional indicators that give simple Buy/Sell signals, the ML model analyzes the complex relationships between historical patterns (RSI, MACD, Moving Averages) to forecast the exact closing price of the next trading day.\n2. Methodology\n\nAlgorithm: We use XGBRegressor (Extreme Gradient Boosting), a robust algorithm highly effective for structured time-series data.\nFeature Engineering: The model inputs include Open, High, Low, Volume, and all technical indicators calculated in Part 1 (SMA, EMA, Bollinger Bands, etc.).\nTraining & Validation: To prevent “data leakage” (looking into the future), the data is split chronologically:\n\nTraining Set (First 80%): Used to teach the model historical patterns.\nTest Set (Last 20%): Used to evaluate how well the model predicts unseen data.\n\n\n3. Interactive Analysis Dashboard\nThe visualization below provides a comprehensive view of the model’s performance. Use the dropdown menu to select a specific ticker:\n\nTop Chart (Actual vs. Predicted): Compares the real market price (Blue line) against the model’s prediction (Orange dotted line). The closer the lines, the better the model accuracy.\nBottom Chart (Feature Importance): Ranks which technical indicators were most influential in determining the price. For example, if RSI has a high bar, the model relies heavily on momentum to make predictions for that specific stock.\n\n\nNote: The table below summarizes the prediction for the next upcoming trading day, including the predicted percentage change.\n\n\n\nCode\n# Prepare features\nfeature_cols &lt;- c(\"open\", \"high\", \"low\", \"close\", \"volume\", \n                  \"SMA_50\", \"SMA_200\", \"EMA_20\", \"RSI_14\", \n                  \"macd\", \"signal\", \"up\", \"mavg\", \"dn\", \"pctB\", \"MFI_14\")\n\nml_results &lt;- list()\nticker_preds &lt;- list()\n\nfor (t in unique(df_ta$ticker)) {\n  ticker_data &lt;- df_ta %&gt;% filter(ticker == t) %&gt;% drop_na(any_of(feature_cols))\n  \n  # Create Target (Shifted Close)\n  ticker_data$target &lt;- lead(ticker_data$close)\n  \n  # Split data\n  train_df &lt;- ticker_data %&gt;% drop_na(target)\n  split_idx &lt;- floor(0.8 * nrow(train_df))\n  \n  train_set &lt;- train_df[1:split_idx, ]\n  test_set  &lt;- train_df[(split_idx + 1):nrow(train_df), ]\n  \n  # XGBoost Matrices\n  dtrain &lt;- xgb.DMatrix(data = as.matrix(train_set[, feature_cols]), label = train_set$target)\n  dtest  &lt;- xgb.DMatrix(data = as.matrix(test_set[, feature_cols]), label = test_set$target)\n  \n  # Train Model\n  model &lt;- xgboost(data = dtrain, nrounds = 100, objective = \"reg:squarederror\", \n                   eta = 0.05, max_depth = 5, verbose = 0)\n  \n  # Predict on test set\n  preds &lt;- predict(model, dtest)\n  rmse_val &lt;- sqrt(mean((test_set$target - preds)^2))\n  \n  # Predict Next Day\n  latest_data &lt;- tail(ticker_data, 1)\n  next_pred &lt;- predict(model, as.matrix(latest_data[, feature_cols]))\n  \n  ml_results[[t]] &lt;- tibble(\n    Ticker = t,\n    Current_Price = latest_data$close,\n    Predicted_Price = next_pred,\n    Change_Pct = ((next_pred - latest_data$close) / latest_data$close) * 100,\n    RMSE = rmse_val\n  )\n}\n\nfinal_ml_results &lt;- bind_rows(ml_results)\n\n# Display ML Table\nfinal_ml_results %&gt;%\n  gt() %&gt;%\n  fmt_percent(columns = Change_Pct, scale_values = FALSE) %&gt;%\n  fmt_number(columns = c(Current_Price, Predicted_Price, RMSE), decimals = 2)\n\n\n\n\n\n\n\n\nTicker\nCurrent_Price\nPredicted_Price\nChange_Pct\nRMSE\n\n\n\n\nAAPL\n248.68\n236.12\n−5.05%\n18.80\n\n\nADBE\n302.73\n306.16\n1.13%\n8.27\n\n\nAMZN\n239.68\n228.56\n−4.64%\n6.58\n\n\nBAC\n51.58\n43.85\n−14.99%\n6.28\n\n\nDIS\n111.56\n110.37\n−1.07%\n2.68\n\n\nGOOGL\n328.39\n188.99\n−42.45%\n68.56\n\n\nHD\n383.07\n379.56\n−0.92%\n10.66\n\n\nJNJ\n218.29\n157.80\n−27.71%\n27.65\n\n\nJPM\n297.76\n259.16\n−12.96%\n37.55\n\n\nKO\n72.26\n67.56\n−6.51%\n2.29\n\n\nMA\n525.59\n524.06\n−0.29%\n21.06\n\n\nMETA\n661.78\n656.55\n−0.79%\n39.42\n\n\nMSFT\n469.30\n424.53\n−9.54%\n64.67\n\n\nNFLX\n86.00\n86.38\n0.44%\n19.34\n\n\nNVDA\n187.94\n127.50\n−32.16%\n43.80\n\n\nPG\n150.58\n151.22\n0.42%\n2.29\n\n\nPYPL\n56.91\n56.10\n−1.43%\n1.57\n\n\nTSLA\n448.26\n415.91\n−7.22%\n31.28\n\n\nUNH\n355.18\n417.20\n17.46%\n96.35\n\n\nV\n327.00\n328.23\n0.38%\n9.99\n\n\nWMT\n118.40\n97.62\n−17.55%\n9.10\n\n\n\n\n\n\n\n\n\nCode\n# Interactive Plotly Chart for the first ticker as an example\nplot_ly(data = df_ta %&gt;% filter(ticker == \"AAPL\")) %&gt;%\n  add_lines(x = ~date, y = ~close, name = \"Actual Price\") %&gt;%\n  layout(title = \"Stock Price Overview\", xaxis = list(title = \"Date\"), yaxis = list(title = \"Price\"))"
  }
]