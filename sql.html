<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Analytics - Database Schema & Queries</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/sql.min.js"></script>
    <script>hljs.highlightAll();</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Navigation Bar Styles */
        .navbar {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 40px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            gap: 12px;
            font-weight: 700;
            font-size: 1.3rem;
        }
        
        .logo-icon {
            background-color: #4fc3f7;
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        .nav-links li {
            position: relative;
        }
        
        .nav-links a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            padding: 8px 0;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-links a:hover {
            color: white;
        }
        
        .nav-links a.active {
            color: white;
            font-weight: 600;
        }
        
        .nav-links a.active:after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #4fc3f7;
            border-radius: 2px;
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
        }
        
        .social-icon {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .social-icon:hover {
            background-color: rgba(79, 195, 247, 0.3);
            transform: translateY(-2px);
        }
        
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 4px;
            cursor: pointer;
        }
        
        .hamburger span {
            width: 25px;
            height: 3px;
            background-color: white;
            border-radius: 2px;
            transition: all 0.3s;
        }
        
        /* Main Content Styles */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 40px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .author {
            font-style: italic;
            margin-top: 10px;
            font-size: 1rem;
            color: #bdc3c7;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 50px;
            border-left: 4px solid #3498db;
            padding-left: 20px;
        }
        
        h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
            display: flex;
            align-items: center;
        }
        
        h2:before {
            content: "ðŸ“Š";
            margin-right: 10px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #2980b9;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
        }
        
        h3:before {
            content: "â–¶";
            margin-right: 10px;
            font-size: 0.9rem;
            color: #1e3c72;
        }
        
        .table-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 3px solid #3498db;
        }
        
        .table-info h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .table-schema {
            margin-bottom: 25px;
        }
        
        .table-columns {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 15px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th {
            background-color: #2c3e50;
            color: white;
            text-align: left;
            padding: 12px 15px;
        }
        
        td {
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .query-description {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 3px solid #4a90e2;
        }
        
        .query-description p {
            margin-bottom: 8px;
        }
        
        .query-description ul {
            margin-left: 20px;
            margin-top: 5px;
        }
        
        pre {
            border-radius: 8px;
            overflow-x: auto;
            margin: 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        code {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
        }
        
        .hljs {
            padding: 20px;
            background-color: #282c34;
        }
        
        .section-nav {
            background-color: #f0f5ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .section-nav h3 {
            margin-top: 0;
            color: #1e3c72;
        }
        
        .nav-links-small {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .nav-link-small {
            background-color: white;
            border: 1px solid #d0d7e7;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            color: #2a5298;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .nav-link-small:hover {
            background-color: #2a5298;
            color: white;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            background-color: #2c3e50;
            color: white;
            font-size: 0.9rem;
        }
        
        @media (max-width: 992px) {
            .nav-links {
                gap: 15px;
            }
            
            .nav-left {
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                margin: 0;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .section {
                padding-left: 15px;
            }
            
            .nav-links {
                position: fixed;
                top: 60px;
                left: 0;
                width: 100%;
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                flex-direction: column;
                padding: 20px;
                gap: 0;
                transform: translateY(-100%);
                opacity: 0;
                transition: all 0.3s;
                z-index: 999;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            }
            
            .nav-links.active {
                transform: translateY(0);
                opacity: 1;
            }
            
            .nav-links li {
                width: 100%;
            }
            
            .nav-links a {
                display: block;
                padding: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .nav-links a:last-child {
                border-bottom: none;
            }
            
            .hamburger {
                display: flex;
            }
            
            .social-links {
                display: none;
            }
        }
        
        .database-info {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        
        .database-info p {
            margin-bottom: 10px;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .page-breadcrumb {
            background-color: #f0f5ff;
            padding: 10px 30px;
            font-size: 0.9rem;
            color: #666;
            border-bottom: 1px solid #eaeaea;
        }
        
        .page-breadcrumb a {
            color: #2a5298;
            text-decoration: none;
        }
        
        .page-breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            margin: 0 8px;
            color: #999;
        }
        
        /* NEW STYLES FOR QUERY RESULTS */
        .query-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px 0;
            border-bottom: 1px solid #eaeaea;
        }
        
        .query-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .query-btn:hover {
            background-color: #3e8e41;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .query-btn.running {
            background-color: #FF9800;
        }
        
        .query-btn.running i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .query-result-container {
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .query-result-container.active {
            max-height: 600px;
            border: 1px solid #ddd;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .result-header {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px 8px 0 0;
        }
        
        .result-header h4 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-result {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .result-content {
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .csv-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .csv-table th {
            background-color: #3498db;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .csv-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .download-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background-color: #2196F3;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .download-link:hover {
            background-color: #0b7dda;
        }
        
        .query-status {
            font-size: 0.9rem;
            color: #666;
        }
        
        .status-success {
            color: #4CAF50;
        }
        
        .status-error {
            color: #f44336;
        }
        
        .code-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #1a1a1a;
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
        }
        
        .code-title {
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .copy-btn {
            background-color: #444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .copy-btn:hover {
            background-color: #555;
        }
        
        .copy-btn.copied {
            background-color: #4CAF50;
        }
        
        .data-info {
            background-color: #e8f5e8;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="index.html" class="logo">
                    <div class="logo-icon">GM</div>
                    <span>Global Market Insight</span>
                </a>
                
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pipeline.html">ETL Pipeline</a></li>
                    <li><a href="sql.html" class="active">SQL Section</a></li>
                    <li><a href="powerbi.html">Dashboards</a></li>
                    <li><a href="reports.html">Reports</a></li>
                    <li><a href="about.html">About Me</a></li>
                </ul>
            </div>
            
            <div class="nav-right">
                <div class="social-links">
                    <a href="https://github.com/laihoangson" class="social-icon" target="_blank" aria-label="GitHub">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/hoang-son-lai-92ab19282/" class="social-icon" target="_blank" aria-label="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
                
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <header>
            <h1>Financial Analytics Database</h1>
            <p class="subtitle">Complete Database Schema & Analytical SQL Queries</p>
        </header>
        
        <div class="content">
            <div class="database-info">
                <h3>Database Overview</h3>
                <p>This database, financial_analytics, is designed for comprehensive financial data analysis including company information, stock prices, and financial statements with calculated ratios.</p>
                <p>The schema consists of 3 main tables that support various analytical queries for fundamental analysis, sector comparison, and market valuation.</p>
                <div class="data-info">
                    <strong><i class="fas fa-info-circle"></i> Interactive Features:</strong> Click "Run Query" to view CSV results from the database. All results are pre-generated and stored in the <code>query_data</code> folder.
                </div>
            </div>
            
            <div class="section" id="schema">
                <h2>DATABASE SCHEMA</h2>
                
                <div class="table-info">
                    <h4>Database: financial_analytics</h4>
                    <p>The database contains three core tables that form the foundation for financial analysis:</p>
                    <ol>
                        <li><strong>companies</strong> - Company metadata and information</li>
                        <li><strong>stock_prices</strong> - Daily historical stock prices</li>
                        <li><strong>financial_statements</strong> - Financial statements with calculated ratios</li>
                    </ol>
                </div>
                
                <div class="table-schema">
                    <h3>1. Table: companies</h3>
                    <p>Stores company metadata including name, sector, industry, and other descriptive information.</p>
                    <div class="table-columns">
                        <table>
                            <thead>
                                <tr>
                                    <th>Column Name</th>
                                    <th>Data Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ticker</td>
                                    <td>VARCHAR(10)</td>
                                    <td>Primary key, stock ticker symbol</td>
                                </tr>
                                <tr>
                                    <td>name</td>
                                    <td>VARCHAR(255)</td>
                                    <td>Company name</td>
                                </tr>
                                <tr>
                                    <td>sector</td>
                                    <td>VARCHAR(100)</td>
                                    <td>Business sector (e.g., Technology, Healthcare)</td>
                                </tr>
                                <tr>
                                    <td>industry</td>
                                    <td>VARCHAR(100)</td>
                                    <td>Specific industry classification</td>
                                </tr>
                                <tr>
                                    <td>country</td>
                                    <td>VARCHAR(100)</td>
                                    <td>Country of headquarters</td>
                                </tr>
                                <tr>
                                    <td>website</td>
                                    <td>VARCHAR(255)</td>
                                    <td>Company website URL</td>
                                </tr>
                                <tr>
                                    <td>description</td>
                                    <td>TEXT</td>
                                    <td>Company description/business overview</td>
                                </tr>
                                <tr>
                                    <td>currency</td>
                                    <td>VARCHAR(10)</td>
                                    <td>Reporting currency</td>
                                </tr>
                                <tr>
                                    <td>last_updated</td>
                                    <td>TIMESTAMP</td>
                                    <td>Updated timestamp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="table-schema">
                    <h3>2. Table: stock_prices</h3>
                    <p>Contains daily historical stock price data including OHLC (Open, High, Low, Close) prices and volume.</p>
                    <div class="table-columns">
                        <table>
                            <thead>
                                <tr>
                                    <th>Column Name</th>
                                    <th>Data Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>INT</td>
                                    <td>Auto-increment primary key</td>
                                </tr>
                                <tr>
                                    <td>ticker</td>
                                    <td>VARCHAR(10)</td>
                                    <td>Foreign key to companies table</td>
                                </tr>
                                <tr>
                                    <td>date</td>
                                    <td>DATE</td>
                                    <td>Trading date</td>
                                </tr>
                                <tr>
                                    <td>open</td>
                                    <td>DECIMAL(15,4)</td>
                                    <td>Opening price</td>
                                </tr>
                                <tr>
                                    <td>high</td>
                                    <td>DECIMAL(15,4)</td>
                                    <td>Daily high price</td>
                                </tr>
                                <tr>
                                    <td>low</td>
                                    <td>DECIMAL(15,4)</td>
                                    <td>Daily low price</td>
                                </tr>
                                <tr>
                                    <td>close</td>
                                    <td>DECIMAL(15,4)</td>
                                    <td>Closing price</td>
                                </tr>
                                <tr>
                                    <td>adj_close</td>
                                    <td>DECIMAL(15,4)</td>
                                    <td>Adjusted closing price</td>
                                </tr>
                                <tr>
                                    <td>volume</td>
                                    <td>BIGINT</td>
                                    <td>Trading volume</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="table-schema">
                    <h3>3. Table: financial_statements</h3>
                    <p>Comprehensive financial statement data including income statement, balance sheet items, and pre-calculated financial ratios.</p>
                    <div class="table-columns">
                        <table>
                            <thead>
                                <tr>
                                    <th>Column Name</th>
                                    <th>Data Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>INT</td>
                                    <td>Auto-increment primary key</td>
                                </tr>
                                <tr>
                                    <td>ticker</td>
                                    <td>VARCHAR(10)</td>
                                    <td>Foreign key to companies table</td>
                                </tr>
                                <tr>
                                    <td>report_date</td>
                                    <td>DATE</td>
                                    <td>Financial report date</td>
                                </tr>
                                <tr>
                                    <td>period</td>
                                    <td>VARCHAR(20)</td>
                                    <td>Reporting period ('12M', 'TTM', '3M')</td>
                                </tr>
                                <tr>
                                    <td>revenue</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Total revenue/sales</td>
                                </tr>
                                <tr>
                                    <td>cogs</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Cost of goods sold</td>
                                </tr>
                                <tr>
                                    <td>gross_profit</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Revenue minus COGS</td>
                                </tr>
                                <tr>
                                    <td>opex</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Operating expenses</td>
                                </tr>
                                <tr>
                                    <td>operating_income_ebit</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Operating income/EBIT</td>
                                </tr>
                                <tr>
                                    <td>ebt</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Earnings before tax</td>
                                </tr>
                                <tr>
                                    <td>net_income</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Net income/profit</td>
                                </tr>
                                <tr>
                                    <td>ebitda</td>
                                    <td>DECIMAL(20,2)</td>
                                    <td>Earnings before interest, tax, depreciation & amortization</td>
                                </tr>
                                <tr>
                                    <td colspan="3" style="text-align: center; background-color: #e3f2fd;"><strong>... Plus 30+ additional columns for balance sheet items and financial ratios</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="query-description" style="margin-top: 15px;">Note: This table includes comprehensive financial data with columns for income statement, balance sheet (assets, liabilities, equity), and pre-calculated financial ratios (profitability, liquidity, solvency, efficiency ratios).</p>
                </div>
                
                <div class="query-description">
                    <h4>Complete Schema SQL</h4>
                    <p>The complete database schema creation script:</p>
                </div>
                <pre><code class="language-sql">-- backend/sql/schema.sql
-- Project: Global Market Insight 360
-- Author: Hoang Son Lai

CREATE DATABASE IF NOT EXISTS financial_analytics;
USE financial_analytics;

-- 1. Table: Company Information
CREATE TABLE IF NOT EXISTS companies (
    ticker VARCHAR(10) PRIMARY KEY,
    name VARCHAR(255),
    sector VARCHAR(100),
    industry VARCHAR(100),
    country VARCHAR(100),
    website VARCHAR(255),
    description TEXT,
    currency VARCHAR(10),
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 2. Table: Stock Prices (Daily)
CREATE TABLE IF NOT EXISTS stock_prices (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ticker VARCHAR(10),
    date DATE,
    open DECIMAL(15, 4),
    high DECIMAL(15, 4),
    low DECIMAL(15, 4),
    close DECIMAL(15, 4),
    adj_close DECIMAL(15, 4),
    volume BIGINT,
    FOREIGN KEY (ticker) REFERENCES companies(ticker) ON DELETE CASCADE,
    UNIQUE KEY unique_stock (ticker, date)
);

-- 3. Table: Financial Statements (Yearly/Quarterly) & Calculated Ratios
CREATE TABLE IF NOT EXISTS financial_statements (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ticker VARCHAR(10),
    report_date DATE,
    period VARCHAR(20), -- '12M' for Yearly, 'TTM' or '3M'

    -- Income Statement
    revenue DECIMAL(20, 2),
    cogs DECIMAL(20, 2),
    gross_profit DECIMAL(20, 2),
    opex DECIMAL(20, 2),
    operating_income_ebit DECIMAL(20, 2),
    ebt DECIMAL(20, 2),
    net_income DECIMAL(20, 2),
    ebitda DECIMAL(20, 2),
    basic_eps DECIMAL(10, 4),
    diluted_eps DECIMAL(10, 4),

    -- Balance Sheet
    total_assets DECIMAL(20, 2),
    current_assets DECIMAL(20, 2),
    cash_and_equivalents DECIMAL(20, 2),
    accounts_receivable DECIMAL(20, 2),
    inventory DECIMAL(20, 2),
    non_current_assets DECIMAL(20, 2),
    total_liabilities DECIMAL(20, 2),
    current_liabilities DECIMAL(20, 2),
    accounts_payable DECIMAL(20, 2),
    short_term_debt DECIMAL(20, 2),
    long_term_debt DECIMAL(20, 2),
    total_equity DECIMAL(20, 2),
    common_stock DECIMAL(20, 2),
    retained_earnings DECIMAL(20, 2),

    -- Calculated Ratios
    current_ratio DECIMAL(10, 4),
    quick_ratio DECIMAL(10, 4),
    cash_ratio DECIMAL(10, 4),
    debt_to_equity DECIMAL(10, 4),
    debt_ratio DECIMAL(10, 4),
    interest_coverage_ratio DECIMAL(10, 4),
    roa DECIMAL(10, 4),
    roe DECIMAL(10, 4),
    gross_margin DECIMAL(10, 4),
    net_margin DECIMAL(10, 4),
    asset_turnover DECIMAL(10, 4),
    inventory_turnover DECIMAL(10, 4),
    receivables_turnover DECIMAL(10, 4),

    FOREIGN KEY (ticker) REFERENCES companies(ticker) ON DELETE CASCADE,
    UNIQUE KEY unique_financial (ticker, report_date)
);</code></pre>
            </div>
            
 <div class="section" id="queries">
    <h2>ANALYTICAL SQL QUERIES</h2>
    
    <div class="section-nav">
        <h3>Query Categories</h3>
        <p>The following analytical queries leverage the database schema to provide insights into company performance, sector comparisons, and market valuation.</p>
        <div class="nav-links-small">
            <a href="#fundamental" class="nav-link-small">Fundamental Analysis</a>
            <a href="#sector" class="nav-link-small">Sector Analysis</a>
            <a href="#market" class="nav-link-small">Market Analysis</a>
        </div>
        <div class="data-info">
            <i class="fas fa-database"></i> All query results are pre-generated and stored as CSV files. Click "Run Query" to view results.
        </div>
    </div>
    
<div class="section" id="fundamental">
    <h3>SECTION 1: FUNDAMENTAL ANALYSIS</h3>
    
    <div class="query-description">
        <p><strong>1. Top 10 Companies by Revenue (Most Recent Year)</strong></p>
        <p>This query identifies the top 10 companies based on revenue using their most recent financial year data.</p>
        <p>Key metrics displayed:</p>
        <ul>
            <li>Company name and sector</li>
            <li>Report date (most recent fiscal year)</li>
            <li>Revenue and net income (formatted with thousand separators)</li>
        </ul>
        <p><em>Note: Only the latest financial statement for each company is considered.</em></p>
    </div>
    
    <div class="code-header-bar">
        <div class="code-title">SQL Query 1</div>
        <button class="copy-btn" data-target="query1-code">Copy</button>
    </div>
    <pre><code class="language-sql" id="query1-code">-- 1. Top 10 Companies by Revenue (Most Recent Year)
WITH LatestFinancials AS (
    SELECT 
        f1.*,
        ROW_NUMBER() OVER (PARTITION BY f1.ticker ORDER BY f1.report_date DESC) as rn
    FROM financial_statements f1
    WHERE f1.revenue IS NOT NULL AND f1.revenue > 0
)
SELECT 
    c.name, 
    c.sector, 
    f.report_date, 
    FORMAT(f.revenue, 0) as revenue, 
    FORMAT(f.net_income, 0) as net_income
FROM LatestFinancials f
JOIN companies c ON f.ticker = c.ticker
WHERE f.rn = 1
ORDER BY f.revenue DESC
LIMIT 10;</code></pre>
    
    <div class="query-controls">
        <div class="query-status" id="status-query1"></div>
        <button class="query-btn" data-query="1">
            <i class="fas fa-play"></i> Run Query 1
        </button>
    </div>
    
    <div class="query-result-container" id="result-query1">
        <div class="result-header">
            <h4><i class="fas fa-table"></i> Query 1 Results: Top 10 Companies by Revenue (Most Recent Year)</h4>
            <button class="close-result" data-target="query1">Ã—</button>
        </div>
        <div class="result-content">
            <!-- Results will be loaded here -->
        </div>
    </div>
    
    <div class="query-description">
        <p><strong>2. Profitability Leaders: Highest Net Profit Margin (Most Recent Year)</strong></p>
        <p>Identifies companies with the highest net profit margin using their most recent financial year data.</p>
        <p>Formula: (Net Income / Revenue) Ã— 100</p>
        <p>Includes both net margin and gross margin percentages for comprehensive analysis.</p>
        <p><em>Note: Only the latest financial statement for each company is considered.</em></p>
    </div>
    
    <div class="code-header-bar">
        <div class="code-title">SQL Query 2</div>
        <button class="copy-btn" data-target="query2-code">Copy</button>
    </div>
    <pre><code class="language-sql" id="query2-code">-- 2. Profitability Leaders: Highest Net Profit Margin (Most Recent Year)
WITH LatestFinancials AS (
    SELECT 
        f1.*,
        ROW_NUMBER() OVER (PARTITION BY f1.ticker ORDER BY f1.report_date DESC) as rn
    FROM financial_statements f1
    WHERE f1.revenue > 0
)
SELECT 
    c.ticker, 
    c.name, 
    f.report_date,
    ROUND(f.net_margin * 100, 2) as net_margin_percent,
    ROUND(f.gross_margin * 100, 2) as gross_margin_percent
FROM LatestFinancials f
JOIN companies c ON f.ticker = c.ticker
WHERE f.rn = 1
ORDER BY f.net_margin DESC
LIMIT 10;</code></pre>
    
    <div class="query-controls">
        <div class="query-status" id="status-query2"></div>
        <button class="query-btn" data-query="2">
            <i class="fas fa-play"></i> Run Query 2
        </button>
    </div>
    
    <div class="query-result-container" id="result-query2">
        <div class="result-header">
            <h4><i class="fas fa-chart-line"></i> Query 2 Results: Highest Net Profit Margin (Most Recent Year)</h4>
            <button class="close-result" data-target="query2">Ã—</button>
        </div>
        <div class="result-content">
            <!-- Results will be loaded here -->
        </div>
    </div>
    
    <div class="query-description">
        <p><strong>3. Financial Health: Companies with High Debt Risk (Debt-to-Equity > 2) - Most Recent Year</strong></p>
        <p>Highlights companies with potentially risky debt levels (Debt-to-Equity ratio > 2) using their most recent financial data.</p>
        <p>Also shows current ratio and interest coverage ratio for further analysis of financial health.</p>
        <p><em>Note: Only the latest financial statement for each company is considered.</em></p>
    </div>
    
    <div class="code-header-bar">
        <div class="code-title">SQL Query 3</div>
        <button class="copy-btn" data-target="query3-code">Copy</button>
    </div>
    <pre><code class="language-sql" id="query3-code">-- 3. Financial Health: Companies with High Debt Risk (Most Recent Year)
WITH LatestFinancials AS (
    SELECT 
        f1.*,
        ROW_NUMBER() OVER (PARTITION BY f1.ticker ORDER BY f1.report_date DESC) as rn
    FROM financial_statements f1
    WHERE f1.debt_to_equity IS NOT NULL
)
SELECT 
    c.name, 
    c.industry, 
    f.debt_to_equity,
    f.current_ratio,
    f.interest_coverage_ratio,
    f.report_date
FROM LatestFinancials f
JOIN companies c ON f.ticker = c.ticker
WHERE f.rn = 1 AND f.debt_to_equity > 2
ORDER BY f.debt_to_equity DESC;</code></pre>
    
    <div class="query-controls">
        <div class="query-status" id="status-query3"></div>
        <button class="query-btn" data-query="3">
            <i class="fas fa-play"></i> Run Query 3
        </button>
    </div>
    
    <div class="query-result-container" id="result-query3">
        <div class="result-header">
            <h4><i class="fas fa-exclamation-triangle"></i> Query 3 Results: High Debt Risk Companies (Most Recent Year)</h4>
            <button class="close-result" data-target="query3">Ã—</button>
        </div>
        <div class="result-content">
            <!-- Results will be loaded here -->
        </div>
    </div>
    
    <div class="query-description">
        <p><strong>4. Efficient Operations: Best Return on Equity (ROE) & ROA (Most Recent Year)</strong></p>
        <p>Ranks companies by Return on Equity (ROE) using their most recent financial year data, showing the top 10 performers.</p>
        <p>Also includes Return on Assets (ROA) for comparison of asset utilization efficiency.</p>
        <p><em>Note: Only the latest financial statement for each company is considered.</em></p>
    </div>
    
    <div class="code-header-bar">
        <div class="code-title">SQL Query 4</div>
        <button class="copy-btn" data-target="query4-code">Copy</button>
    </div>
    <pre><code class="language-sql" id="query4-code">-- 4. Efficient Operations: Best Return on Equity (ROE) & ROA (Most Recent Year)
WITH LatestFinancials AS (
    SELECT 
        f1.*,
        ROW_NUMBER() OVER (PARTITION BY f1.ticker ORDER BY f1.report_date DESC) as rn
    FROM financial_statements f1
    WHERE f1.roe IS NOT NULL
)
SELECT 
    c.ticker,
    c.name,
    f.report_date,
    ROUND(f.roe * 100, 2) as roe_percent,
    ROUND(f.roa * 100, 2) as roa_percent
FROM LatestFinancials f
JOIN companies c ON f.ticker = c.ticker
WHERE f.rn = 1
ORDER BY f.roe DESC
LIMIT 10;</code></pre>
    
    <div class="query-controls">
        <div class="query-status" id="status-query4"></div>
        <button class="query-btn" data-query="4">
            <i class="fas fa-play"></i> Run Query 4
        </button>
    </div>
    
    <div class="query-result-container" id="result-query4">
        <div class="result-header">
            <h4><i class="fas fa-tachometer-alt"></i> Query 4 Results: Best ROE & ROA (Most Recent Year)</h4>
            <button class="close-result" data-target="query4">Ã—</button>
        </div>
        <div class="result-content">
            <!-- Results will be loaded here -->
        </div>
    </div>
</div>

<div class="section" id="sector">
    <h3>SECTION 2: SECTOR ANALYSIS</h3>
    
    <div class="query-description">
        <p><strong>5. Average Profit Margin by Sector (Most Recent Year)</strong></p>
        <p>Aggregates financial metrics at the sector level using the most recent financial year data for each company.</p>
        <p>Shows average net margin and ROE for each sector, along with the number of companies and the latest report date.</p>
        <p><em>Note: Only the latest financial statement for each company is considered for accurate sector comparisons.</em></p>
    </div>
    
    <div class="code-header-bar">
        <div class="code-title">SQL Query 5</div>
        <button class="copy-btn" data-target="query5-code">Copy</button>
    </div>
    <pre><code class="language-sql" id="query5-code">-- 5. Average Profit Margin by Sector (Most Recent Year)
WITH LatestFinancials AS (
    SELECT 
        f1.*,
        ROW_NUMBER() OVER (PARTITION BY f1.ticker ORDER BY f1.report_date DESC) as rn
    FROM financial_statements f1
    WHERE f1.revenue > 0
),
LatestCompanyData AS (
    SELECT 
        c.sector,
        f.ticker,
        f.net_margin,
        f.roe,
        f.report_date
    FROM LatestFinancials f
    JOIN companies c ON f.ticker = c.ticker
    WHERE f.rn = 1
)
SELECT 
    sector,
    COUNT(DISTINCT ticker) as company_count,
    ROUND(AVG(net_margin) * 100, 2) as avg_net_margin_percent,
    ROUND(AVG(roe) * 100, 2) as avg_roe_percent,
    MAX(report_date) as latest_report_date
FROM LatestCompanyData
GROUP BY sector
ORDER BY avg_net_margin_percent DESC;</code></pre>
    
    <div class="query-controls">
        <div class="query-status" id="status-query5"></div>
        <button class="query-btn" data-query="5">
            <i class="fas fa-play"></i> Run Query 5
        </button>
    </div>
    
    <div class="query-result-container" id="result-query5">
        <div class="result-header">
            <h4><i class="fas fa-industry"></i> Query 5 Results: Average Profit Margin by Sector (Most Recent Year)</h4>
            <button class="close-result" data-target="query5">Ã—</button>
        </div>
        <div class="result-content">
            <!-- Results will be loaded here -->
        </div>
    </div>
</div>
    
    <div class="section" id="market">
        <h3>SECTION 3: MARKET ANALYSIS & VALUATION</h3>
        
        <div class="query-description">
            <p><strong>6. Calculate P/E Ratio (Price-to-Earnings) manually</strong></p>
            <p>Calculates P/E ratio by joining the most recent stock price with the most recent earnings per share (EPS).</p>
            <p>Uses Common Table Expressions (CTEs) to get latest price and EPS data before joining them.</p>
        </div>
        
        <div class="code-header-bar">
            <div class="code-title">SQL Query 6</div>
            <button class="copy-btn" data-target="query6-code">Copy</button>
        </div>
        <pre><code class="language-sql" id="query6-code">-- 6. Calculate P/E Ratio (Price-to-Earnings) manually
WITH LatestPrice AS (
    -- Get the most recent closing price for each ticker
    SELECT ticker, close as latest_price, date
    FROM stock_prices
    WHERE date = (SELECT MAX(date) FROM stock_prices)
),
LatestEPS AS (
    -- Get the most recent EPS
    SELECT ticker, basic_eps, report_date
    FROM financial_statements
    WHERE (ticker, report_date) IN (
        SELECT ticker, MAX(report_date) 
        FROM financial_statements 
        GROUP BY ticker
    )
)
SELECT 
    lp.ticker,
    lp.latest_price,
    le.basic_eps,
    ROUND(lp.latest_price / NULLIF(le.basic_eps, 0), 2) as PE_Ratio
FROM LatestPrice lp
JOIN LatestEPS le ON lp.ticker = le.ticker
ORDER BY PE_Ratio ASC;</code></pre>
        
        <div class="query-controls">
            <div class="query-status" id="status-query6"></div>
            <button class="query-btn" data-query="6">
                <i class="fas fa-play"></i> Run Query 6
            </button>
        </div>
        
        <div class="query-result-container" id="result-query6">
            <div class="result-header">
                <h4><i class="fas fa-calculator"></i> Query 6 Results: P/E Ratio Calculation</h4>
                <button class="close-result" data-target="query6">Ã—</button>
            </div>
            <div class="result-content">
                <!-- Results will be loaded here -->
            </div>
        </div>
        
        <div class="query-description">
            <p><strong>7. Stock Volatility</strong></p>
            <p>Calculates price volatility for each stock using standard deviation of closing prices.</p>
            <p>Also shows average price, minimum and maximum prices during the period for context.</p>
        </div>
        
        <div class="code-header-bar">
            <div class="code-title">SQL Query 7</div>
            <button class="copy-btn" data-target="query7-code">Copy</button>
        </div>
        <pre><code class="language-sql" id="query7-code">-- 7. Stock Volatility 
-- Calculate Standard Deviation of close price
SELECT 
    ticker,
    ROUND(AVG(close), 2) as avg_price,
    ROUND(STDDEV(close), 2) as price_volatility,
    MIN(close) as min_price_period,
    MAX(close) as max_price_period
FROM stock_prices
GROUP BY ticker
ORDER BY price_volatility DESC;</code></pre>
        
        <div class="query-controls">
            <div class="query-status" id="status-query7"></div>
            <button class="query-btn" data-query="7">
                <i class="fas fa-play"></i> Run Query 7
            </button>
        </div>
        
        <div class="query-result-container" id="result-query7">
            <div class="result-header">
                <h4><i class="fas fa-chart-area"></i> Query 7 Results: Stock Volatility Analysis</h4>
                <button class="close-result" data-target="query7">Ã—</button>
            </div>
            <div class="result-content">
                <!-- Results will be loaded here -->
            </div>
        </div>
        
        <div class="query-description">
            <p><strong>8. Moving Average for Apple (Calculating 30-Day Moving Average)</strong></p>
            <p>Calculates a 30-day moving average for Apple (AAPL) stock price using window functions.</p>
            <p>Demonstrates technical analysis calculation for a specific stock.</p>
        </div>
        
        <div class="code-header-bar">
            <div class="code-title">SQL Query 8</div>
            <button class="copy-btn" data-target="query8-code">Copy</button>
        </div>
        <pre><code class="language-sql" id="query8-code">-- 8. Moving Average for Apple (Calculating 30-Day Moving Average)
SELECT 
    ticker,
    date,
    close,
    AVG(close) OVER (
        PARTITION BY ticker 
        ORDER BY date 
        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW
    ) as MA_30
FROM stock_prices
WHERE ticker = 'AAPL' 
ORDER BY date DESC
LIMIT 100;</code></pre>
        
        <div class="query-controls">
            <div class="query-status" id="status-query8"></div>
            <button class="query-btn" data-query="8">
                <i class="fas fa-play"></i> Run Query 8
            </button>
        </div>
        
        <div class="query-result-container" id="result-query8">
            <div class="result-header">
                <h4><i class="fab fa-apple"></i> Query 8 Results: Apple 30-Day Moving Average</h4>
                <button class="close-result" data-target="query8">Ã—</button>
            </div>
            <div class="result-content">
                <!-- Results will be loaded here -->
            </div>
        </div>
    </div>
</div>

<footer>
    <p>Global Market Insight 360 - Financial Analytics Platform &copy; 2025</p>
    <p>Database Schema & Analytical SQL Queries | Author: Hoang Son Lai</p>
    <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.8;">Note: Query results are loaded from pre-generated CSV files in the <code>query_data</code> folder.</p>
</footer>
</div>
    
    <script>
        // Hamburger menu toggle for mobile
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        
        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            hamburger.classList.toggle('active');
        });
        
        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                hamburger.classList.remove('active');
            });
        });
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('.navbar a, .nav-link-small').forEach(link => {
            link.addEventListener('click', function(e) {
                // Only handle hash links for smooth scrolling
                if (this.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });
        
        // Highlight current section in navigation
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('.navbar a');
            
            let currentSection = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.clientHeight;
                
                if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
                    currentSection = '#' + section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                if (link.getAttribute('href').startsWith('#')) {
                    link.style.backgroundColor = '';
                    
                    if (link.getAttribute('href') === currentSection) {
                        link.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
                    }
                }
            });
        });
        
        // NEW JAVASCRIPT FOR QUERY FUNCTIONALITY
        
        // CSV file paths for each query
        const queryFiles = {
            1: 'query_data/result1.csv',
            2: 'query_data/result2.csv',
            3: 'query_data/result3.csv',
            4: 'query_data/result4.csv',
            5: 'query_data/result5.csv',
            6: 'query_data/result6.csv',
            7: 'query_data/result7.csv',
            8: 'query_data/result8.csv'
        };
        
        // Parse CSV string to array (cáº£i tiáº¿n Ä‘á»ƒ xá»­ lÃ½ dáº¥u pháº©y trong giÃ¡ trá»‹)
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return { headers: [], data: [] };
            
            // HÃ m phÃ¢n tÃ­ch cÃº phÃ¡p dÃ²ng CSV vá»›i xá»­ lÃ½ dáº¥u ngoáº·c kÃ©p
            function parseCSVLine(line) {
                const result = [];
                let currentField = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const nextChar = i + 1 < line.length ? line[i + 1] : '';
                    
                    if (char === '"') {
                        // Náº¿u cÃ³ 2 dáº¥u ngoáº·c kÃ©p liÃªn tiáº¿p, Ä‘Ã³ lÃ  dáº¥u ngoáº·c kÃ©p Ä‘Æ°á»£c thoÃ¡t
                        if (inQuotes && nextChar === '"') {
                            currentField += '"';
                            i++; // Bá» qua dáº¥u ngoáº·c kÃ©p tiáº¿p theo
                        } else {
                            // Báº¯t Ä‘áº§u hoáº·c káº¿t thÃºc trÆ°á»ng trong ngoáº·c kÃ©p
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        // Dáº¥u phÃ¢n cÃ¡ch trÆ°á»ng
                        result.push(currentField);
                        currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                
                // ThÃªm trÆ°á»ng cuá»‘i cÃ¹ng
                result.push(currentField);
                return result;
            }
            
            // PhÃ¢n tÃ­ch tiÃªu Ä‘á»
            const headers = parseCSVLine(lines[0]).map(h => h.trim());
            
            // PhÃ¢n tÃ­ch dá»¯ liá»‡u
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const fields = parseCSVLine(lines[i]);
                if (fields.length === headers.length) {
                    const obj = {};
                    headers.forEach((header, index) => {
                        obj[header] = fields[index] ? fields[index].trim() : '';
                    });
                    data.push(obj);
                }
            }
            
            return { headers, data };
        }
        
// Create HTML table from CSV data - táº¥t cáº£ Ä‘á»u cÄƒn giá»¯a
function createTableFromCSV(csvData) {
    const { headers, data } = csvData;
    
    let html = `<table style="width: 100%; text-align: center; border-collapse: collapse; margin: 15px 0;">`;
    
    // Create header row
    html += '<thead><tr>';
    headers.forEach(header => {
        html += `<th style="padding: 12px; background: #4a6fa5; color: white; border-bottom: 3px solid #2a4a7a;">${header}</th>`;
    });
    html += '</tr></thead>';
    
    // Create data rows
    html += '<tbody>';
    data.forEach((row, rowIndex) => {
        const bgColor = rowIndex % 2 === 0 ? '#f8f9fa' : '#ffffff';
        html += `<tr style="background-color: ${bgColor};">`;
        headers.forEach(header => {
            const value = row[header] || '';
            html += `<td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: center;">${value}</td>`;
        });
        html += '</tr>';
    });
    html += '</tbody></table>';
    
    return html;
}
        
        // Load CSV file
        async function loadCSV(queryNumber) {
            const filePath = queryFiles[queryNumber];
            const statusElement = document.getElementById(`status-query${queryNumber}`);
            
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                const csvData = parseCSV(csvText);
                
                return {
                    success: true,
                    data: csvData,
                    rowCount: csvData.data.length
                };
            } catch (error) {
                console.error(`Error loading CSV for query ${queryNumber}:`, error);
                
                if (statusElement) {
                    statusElement.innerHTML = `<span class="status-error"><i class="fas fa-times-circle"></i> Error loading data: ${error.message}</span>`;
                }
                
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        // Run query button click handler
        document.querySelectorAll('.query-btn').forEach(button => {
            button.addEventListener('click', async function() {
                const queryNumber = this.getAttribute('data-query');
                const resultContainer = document.getElementById(`result-query${queryNumber}`);
                const statusElement = document.getElementById(`status-query${queryNumber}`);
                
                // Show loading state
                this.classList.add('running');
                this.innerHTML = '<i class="fas fa-spinner"></i> Loading...';
                
                if (statusElement) {
                    statusElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading data from CSV...';
                }
                
                // Close any other open result containers
                document.querySelectorAll('.query-result-container.active').forEach(container => {
                    if (container.id !== `result-query${queryNumber}`) {
                        container.classList.remove('active');
                    }
                });
                
                // Load and display CSV data
                const result = await loadCSV(queryNumber);
                
                // Reset button state
                this.classList.remove('running');
                this.innerHTML = '<i class="fas fa-play"></i> Run Query ' + queryNumber;
                
                if (result.success) {
                    const csvData = result.data;
                    const rowCount = result.rowCount;
                    
                    // Update status
                    if (statusElement) {
                        statusElement.innerHTML = `<span class="status-success"><i class="fas fa-check-circle"></i> Loaded ${rowCount} rows from CSV</span>`;
                    }
                    
                    // Create table HTML
                    const tableHTML = createTableFromCSV(csvData);
                    
                    // Create download link
                    const downloadLink = `<a href="${queryFiles[queryNumber]}" class="download-link" download="query${queryNumber}_results.csv">
                        <i class="fas fa-download"></i> Download CSV (${rowCount} rows)
                    </a>`;
                    
                    // Update result container
                    const contentDiv = resultContainer.querySelector('.result-content');
                    contentDiv.innerHTML = `
                        <div class="data-info">
                            <i class="fas fa-info-circle"></i> Showing ${rowCount} rows from CSV file: <code>${queryFiles[queryNumber]}</code>
                        </div>
                        ${tableHTML}
                        <div style="margin-top: 15px;">
                            ${downloadLink}
                        </div>
                    `;
                    
                    // Show result container
                    resultContainer.classList.add('active');
                    
                    // Scroll to result container
                    setTimeout(() => {
                        resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                    
                } else {
                    // Show error in result container
                    const contentDiv = resultContainer.querySelector('.result-content');
                    contentDiv.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <h4>Error Loading Data</h4>
                            <p>Could not load CSV file: ${queryFiles[queryNumber]}</p>
                            <p style="font-size: 0.9rem; margin-top: 10px;">Error: ${result.error}</p>
                            <p style="font-size: 0.8rem; margin-top: 5px;">Make sure the CSV file exists in the query_data folder.</p>
                        </div>
                    `;
                    
                    // Show result container
                    resultContainer.classList.add('active');
                }
            });
        });
        
        // Close result container
        document.querySelectorAll('.close-result').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const container = document.getElementById(`result-${targetId}`);
                container.classList.remove('active');
            });
        });
        
        // Copy code functionality
        document.querySelectorAll('.copy-btn').forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const codeElement = document.getElementById(targetId);
                const codeText = codeElement.textContent;
                
                // Copy to clipboard
                navigator.clipboard.writeText(codeText).then(() => {
                    // Show copied state
                    const originalText = this.textContent;
                    this.textContent = 'Copied!';
                    this.classList.add('copied');
                    
                    // Reset after 2 seconds
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    this.textContent = 'Error!';
                    
                    setTimeout(() => {
                        this.textContent = 'Copy';
                    }, 2000);
                });
            });
        });
        
        // Auto-load first query on page load (optional)
        // Uncomment the line below if you want to auto-load a query when page loads
        // document.querySelector('.query-btn[data-query="1"]').click();
        
        // Close result containers when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.query-result-container') && 
                !event.target.closest('.query-btn') && 
                !event.target.closest('.close-result')) {
                document.querySelectorAll('.query-result-container.active').forEach(container => {
                    container.classList.remove('active');
                });
            }
        });
        
        // Display file paths information
        console.log('CSV files expected in query_data folder:');
        Object.entries(queryFiles).forEach(([queryNum, filePath]) => {
            console.log(`Query ${queryNum}: ${filePath}`);
        });
    </script>
</body>
</html>